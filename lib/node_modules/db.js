var mongoose=require("mongoose");


mongoose.connect("mongodb://localhost/articles");
var db=mongoose.connection;

db.on("error",function(){
    console.error("connection error:");
})



console.log("db has connected");

var articlesSchema=mongoose.Schema({
    id:"",
    title:"",
    type:"",
    date:"",
    content:"",
    description:""
})

var articles=mongoose.model("articles",articlesSchema);

// var newarticle=new articles({
//     id:0,
//     title:"work together",
//     author:"lewine",
//     type:"translate",
//     date:"2016-05-13",
//     content:"just a joke",
//     description:"get it"
// })
// newarticle.save(function(err,data){
//     if(err)console.error(err);
//     console.log(data);
// })

function queryall(res){
    articles.find(function(error,data) {
        if(error){
            console.error(error);
        }else{
            res.writeHead(200,{'Content-Type': 'application/json'});
            res.end(JSON.stringify(data),"utf-8");
        }
    })
}   
    
function delData(req,res) {
    var deldata="";
    req.on("data",function(data){
        deldata+=data;
    })
    req.on("end",function(){
        articles.remove({id:deldata.id},function(error){
            if(error){
                console.log(error);
            }else{
                var dpdata={"check":true}
                res.writeHead(200,{"Content-Type":"application/json"});
                res.end(JSON.stringify(dpdata),"utf-8")
            }
        })
    })
}



exports.queryall=queryall;
exports.delData=delData;