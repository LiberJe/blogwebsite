var mysql =require("mysql");

var connection=mysql.createConnection({
    host:"127.0.0.1",
    port:"3306",
    user:"root",
    password:"root",
    database:"website"
})

connection.connect(function(err) {
    if(err){
        console.error(err);
    }
    console.log("connection succed");
})

function queryall(res) {
    connection.query("SELECT * FROM articles",function(err,data) {
        if(err){
            console.error(err);
        }else{
            res.writeHead(200,{'Content-Type': 'application/json'});
            res.end(JSON.stringify(data),"utf-8");
        }
    })
}

function update(req,res) {
    var updation="";
    req.on("data",function(data) {
        updation+=data;
        console.log(updation);
    })
    req.on("end",function(data){
        var val=JSON.parse(updation);
        var condition="UPDATE articles SET content=?,type=?,title=? WHERE id=?";
        var conditonval=[val.content,val.type,val.title,val.id];
        connection.query(condition,conditonval,function(err,data){
            if(err){
                console.error("err");
            }else{
                var dpdata={"check":true};
                res.writeHead(200,{"Content-Type":"application/json"});
                res.end(JSON.stringify(dpdata),"utf-8");
            }
        })
    })
}

function create(req,res) {
    var addtion="";
    req.on("data",function(data){
        addtion+=data;
    })
    req.on("end",function(data){
        var val=JSON.parse(addtion);
        console.log(val);
        var condition="INSERT INTO articles (title,type,date,description,content) VALUES(?,?,?,?,?)";
        var conditonval=[val.title,val.type,val.date,val.description,val.content];
        connection.query(condition,conditonval,function(err,data){
            if(err){
                console.error(err);
            }else{
                var dpdata={"check":true}
                res.writeHead(200,{"Content-Type":"application/json"});
                res.end(JSON.stringify(dpdata),"utf-8");
            }
        })
    })
}

function delData(req,res) {
    var deldata="";
    req.on("data",function(data){
        deldata+=data;
    })
    req.on("end",function(data){
        var val=JSON.parse(deldata);
        var condition="DELETE FROM articles WHERE id="+val.id;
        
        connection.query(condition,function(err,data) {
            if(err){
                console.error(err);
            }else{
                var dpdata={"check":true}
                res.writeHead(200,{"Content-Type":"application/json"});
                res.end(JSON.stringify(dpdata),"utf-8");
            }
        })
    })
}

exports.queryall=queryall;
exports.update=update;
exports.create=create;
exports.delData=delData;